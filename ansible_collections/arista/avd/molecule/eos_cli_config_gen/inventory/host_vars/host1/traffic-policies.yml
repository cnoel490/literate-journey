---
traffic_policies:
  options:
    counter_per_interface: true
    counter_interface_poll_interval: 10
  field_sets:
    ports:
      - name: SERVICE-DEMO
        port_range: "10,20,80,440-450"
      - name: SERVICE-DEMO2
    ipv4:
      - name: DEMO-02
        prefixes:
          - 172.16.0.0/12
          - 224.0.0.0/8
      - name: DEMO-01
        prefixes:
          - 10.0.0.0/8
          - 192.168.0.0/16
        except:
          - 172.16.0.0/16
          - 10.10.0.0/16
          - 10.2.2.2/32
      - name: DEMO-03
  policies:
    - name: BLUE-C1-POLICY
      default_actions:
        ipv4:
          drop: true
      counters:
        - DEMO-TRAFFIC
        - DROP-PACKETS
      matches:
        - name: BLUE-C1-POLICY-01
          type: ipv4
          source:
            prefixes:
              - 10.0.0.0/8
              - 192.168.0.0/16
          destination:
            prefix_lists:
              - DEMO-01
          protocols:
            - protocol: tcp
              src_port: "1,10-20"
            - protocol: udp
              src_field: SERVICE-DEMO
              flags:
                - established
          ttl: "10, 20-30"
          actions:
            traffic_class: 5
            redirect:
              next_hop:
                # Test next_hop ipv6 without VRF
                ipv6_addresses: [ 2001:db8::1, fd00::abcd:1234 ]
        - name: BLUE-C1-POLICY-02
          type: ipv4
          source:
            prefix_lists:
              - DEMO-01
              - DEMO-02
          protocols:
            - protocol: tcp
              dst_field: SERVICE-DEMO
              flags:
                - established
            - protocol: icmp
          actions:
            count: DEMO-TRAFFIC
            dscp: 60
            redirect:
              next_hop:
                # Test next_hop ipv4 without VRF
                ipv4_addresses: [ 2.2.2.2, 2.2.2.1 ]
        - name: BLUE-C1-POLICY-03
          type: ipv4
          source:
            prefix_lists:
              - DEMO-01
          protocols:
            - protocol: icmp
              icmp_type:
                - echo
                - echo-reply
          fragment:
            offset: "1124, 2000-2010"
          actions:
            count: DROP-PACKETS
            drop: true
            log: true
            redirect:
              aggregation_groups: [group3, group1, group2]
              interface: Ethernet 1-4
        - name: BLUE-C1-POLICY-04
          type: ipv4
          source:
            prefix_lists:
              - DEMO-02
          destination:
            prefix_lists:
              - DEMO-01
          protocols:
            - protocol: tcp
              src_port: "22"
              dst_port: "80"
              flags:
                - established
            - protocol: icmp
          actions:
            traffic_class: 5
            redirect:
              next_hop:
                # Test next_hop ipv4 with VRF
                ipv4_addresses: [ 3.3.3.3, 1.1.1.1 ]
                vrf: VRF_IPv4
        - name: BLUE-C1-POLICY-05
          type: ipv4
          source:
            prefix_lists:
              - DEMO-02
          destination:
            prefix_lists:
              - DEMO-01
          protocols:
            - protocol: bgp
          fragment:
          actions:
            traffic_class: 5
            redirect:
              next_hop:
                # Test next_hop ipv6 with VRF
                ipv6_addresses: [ 2001:0db8:0000:0000:0000:0000:0000:0001, fe80:0000:0000:0000:f2de:f1ff:fe3f:307e ]
                vrf: VRF_IPv6
                # groups should not work
                groups: [ web_servers, db_servers ]
        - name: BLUE-C1-POLICY-06
          type: ipv4
          protocols:
            - protocol: neighbors
            - protocol: udp
              dst_port: "1,10-20"
              src_port: "22"
            - protocol: tcp
              src_port: "22"
              flags:
                - established
              icmp_type:
                - echo
                - echo-reply
            - protocol: icmp
          actions:
            log: false
            redirect:
              next_hop:
                # Testing groups
                groups: [ load_balancers, monitoring_tools ]
        - name: BLUE-C1-POLICY-07
          type: ipv4
          destination:
            prefixes:
              - 10.0.0.0/8
              - 192.168.0.0/16
          actions:
            redirect:
              next_hop:
                # Test next_hop recursive ipv4 with VRF
                recursive_ipv4_addresses: [ 3.3.3.1, 1.1.1.3 ]
                vrf: VRF_IPv4_recursive
        - name: BLUE-C1-POLICY-08
          type: ipv4
          destination:
            prefixes:
              - 10.0.0.0/8
              - 192.168.0.0/16
            prefix_lists:
              - DEMO-01
          protocols:
            - protocol: udp
              dst_port: "1,10-20"
              flags:
                - established
            - protocol: tcp
              dst_field: SERVICE-DEMO-DST
              src_field: SERVICE-DEMO-SRC
          actions:
            redirect:
              next_hop:
                # Test next_hop recursive ipv4 without VRF
                recursive_ipv4_addresses: [ 14.2.3.1, 13.2.1.3 ]
    - name: BLUE-C2-POLICY
      default_actions:
        ipv4:
          drop: true
          log: true
      counters:
        - DEMO-TRAFFIC
      matches:
        - name: BLUE-C2-POLICY-01
          type: ipv4
          source:
            prefixes:
              - 10.0.0.0/8
              - 192.168.0.0/16
          protocols:
            - protocol: tcp
              src_port: "1,10-20"
            - protocol: icmp
          actions:
            traffic_class: 5
            redirect:
              next_hop:
                # Test next_hop recursive ipv6 with VRF
                recursive_ipv6_addresses: [ 2a00:1450:4009:821::200e ]
                vrf: VRF_IPv6_recursive
        - name: BLUE-C2-POLICY-02
          type: ipv4
          source:
            prefix_lists:
              - DEMO-01
              - DEMO-02
          protocols:
            - protocol: tcp
              src_field: SERVICE-DEMO
            - protocol: icmp
          actions:
            count: DEMO-TRAFFIC
            dscp: 60
            redirect:
              next_hop:
                # Test next_hop recursive ipv6 without VRF
                recursive_ipv6_addresses: [ 2606:4700:4700::1111, 2001:4860:4860::8888 ]
        - name: BLUE-C2-POLICY-03
          type: ipv4
          source:
            prefix_lists:
              - DEMO-01
          protocols:
            - protocol: tcp
          actions:
            drop: true
            redirect:
              next_hop:
                # Test next_hop ipv6 without VRF with ttl
                ipv6_addresses: [ 2001:db8::1, fd00::abcd:1234 ]
                ttl: 3
        # Test redirect for type: ipv6
        - name: BLUE-C2-POLICY-04
          type: ipv6
          actions:
            redirect:
              interface: Ethernet 6
        - name: BLUE-C2-POLICY-05
          type: ipv6
          actions:
            redirect:
              next_hop:
                # Test next_hop ipv4 with VRF with ttl
                ipv4_addresses: [ 2.2.2.43, 2.2.2.33 ]
                ttl: 5
                vrf: VRF_TTL_IPv4
        - name: BLUE-C2-POLICY-06
          type: ipv4
          actions:
            redirect:
              next_hop:
                # Testing groups with ttl
                groups: [ Testing_TTL_GROUP ]
                ttl: 44
        - name: BLUE-C2-POLICY-07
          type: ipv4
          actions:
            redirect:
              next_hop:
                # Testing negative ttl it should not reflect.
                ttl: 44
    - name: BLUE-C3-POLICY
      default_actions:
        ipv4:
          count: test
          traffic_class: 10
          dscp: 11
      counters:
        - test
    - name: BLUE-C4-POLICY
      default_actions:
        ipv6:
          count: test
          traffic_class: 10
          dscp: 11
      counters:
        - test
    - name: BLUE-C6-POLICY
      default_actions:
        ipv6:
          drop: true
    - name: BLUE-C5-POLICY
      default_actions:
        ipv6:
          drop: true
          log: true
    - name: BLUE-C7-POLICY
      matches:
        - name: BLUE-C7-POLICY-01
          type: ipv4
          protocols:
            - protocol: neighbors
              enforce_gtsm: true
