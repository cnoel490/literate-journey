!
no enable password
no aaa root
!
vlan internal order ascending range 1006 1199
!
transceiver qsfp default-mode 4x10G
!
service routing protocols model multi-agent
!
hostname ospf-cleartext-passwords
!
vlan 201
   name Tenant_OSPF_201
!
vlan 202
   name Tenant_OSPF_202
!
vlan 204
   name Tenant_OSPF_204
!
vlan 211
   name Tenant_OSPF_211
!
vlan 212
   name Tenant_OSPF_212
!
vlan 213
   name Tenant_OSPF_213
!
vlan 221
   name Tenant_OSPF_221
!
vlan 222
   name Tenant_OSPF_222
!
vrf instance MGMT
!
vrf instance Tenant_OSPF_NO_VRF_LEVEL_ENCRYPTION
!
vrf instance Tenant_OSPF_VRF_LEVEL_MESSAGE_DIGEST_ENCRYPTION
!
vrf instance Tenant_OSPF_VRF_LEVEL_SIMPLE_ENCRYPTION
!
management api http-commands
   protocol https
   no shutdown
   !
   vrf MGMT
      no shutdown
!
interface Port-Channel1111
   no shutdown
   no switchport
   vrf Tenant_OSPF_VRF_LEVEL_SIMPLE_ENCRYPTION
!
interface Port-Channel1111.100
   description Overwriting auth from VRF
   no shutdown
   encapsulation dot1q vlan 100
   vrf Tenant_OSPF_VRF_LEVEL_SIMPLE_ENCRYPTION
   ip address 1.1.1.30/29
   ip ospf cost 1
   ip ospf authentication
   ip ospf authentication-key 7 +oVRU77kd/5nRCNVsBX3Cg==
   ip ospf area 0.0.0.0
!
interface Port-Channel1111.200
   description Overwriting auth from VRF
   no shutdown
   encapsulation dot1q vlan 200
   vrf Tenant_OSPF_VRF_LEVEL_SIMPLE_ENCRYPTION
   ip address 1.1.1.30/29
   ip ospf cost 1
   ip ospf authentication message-digest
   ip ospf area 0.0.0.0
   ip ospf message-digest-key 1 sha256 7 E0jGVE3URUKr+fD/bQZ+pg==
   ip ospf message-digest-key 2 sha512 7 qjRvJ2mZFsoaAn4tvtPQJQ==
!
interface Port-Channel1111.300
   description Inheriting auth from VRF
   no shutdown
   encapsulation dot1q vlan 300
   vrf Tenant_OSPF_VRF_LEVEL_SIMPLE_ENCRYPTION
   ip address 1.1.1.30/29
   ip ospf cost 1
   ip ospf authentication
   ip ospf authentication-key 7 9E3KLtsVQiU2a3o2oZjW9g==
   ip ospf area 0.0.0.0
!
interface Ethernet1
   description Overwriting auth from VRF
   no shutdown
   mtu 9000
   no switchport
   vrf Tenant_OSPF_VRF_LEVEL_SIMPLE_ENCRYPTION
   ip address 10.10.10.10/24
   ip ospf cost 100
   ip ospf network point-to-point
   ip ospf authentication message-digest
   ip ospf area 0.0.0.0
   ip ospf message-digest-key 1 sha1 7 CSjTKv7UtuWSOX61bToedQ==
   ip ospf message-digest-key 2 sha512 7 GIZ1Ijn4iX/O7cMzx6hvQw==
!
interface Ethernet2
   description Inheriting auth from VRF
   no shutdown
   mtu 9000
   no switchport
   vrf Tenant_OSPF_VRF_LEVEL_SIMPLE_ENCRYPTION
   ip address 10.10.20.10/24
   ip ospf cost 100
   ip ospf authentication
   ip ospf authentication-key 7 UnHHiw1TWZmusxSp7UTv8A==
   ip ospf area 0.0.0.0
!
interface Ethernet3
   description Overwriting auth from VRF
   no shutdown
   mtu 9000
   no switchport
   vrf Tenant_OSPF_VRF_LEVEL_MESSAGE_DIGEST_ENCRYPTION
   ip address 10.10.10.10/24
   ip ospf cost 100
   ip ospf network point-to-point
   ip ospf authentication message-digest
   ip ospf area 0.0.0.0
   ip ospf message-digest-key 2 sha1 7 /C/niiEn6nMb0iGrY9wDFA==
   ip ospf message-digest-key 3 sha512 7 XaztaZrAwBLGMEZ3zjNKYQ==
!
interface Ethernet4
   description Inheriting auth from VRF
   no shutdown
   mtu 9000
   no switchport
   vrf Tenant_OSPF_VRF_LEVEL_MESSAGE_DIGEST_ENCRYPTION
   ip address 10.10.20.10/24
   ip ospf cost 100
   ip ospf network point-to-point
   ip ospf authentication message-digest
   ip ospf area 0.0.0.0
   ip ospf message-digest-key 1 sha256 7 00IuE5yntrVCfN1cc/AlpA==
!
interface Ethernet5
   description Overwriting auth from VRF
   no shutdown
   mtu 9000
   no switchport
   vrf Tenant_OSPF_NO_VRF_LEVEL_ENCRYPTION
   ip address 10.10.10.10/24
   ip ospf cost 100
   ip ospf network point-to-point
   ip ospf authentication message-digest
   ip ospf area 0.0.0.0
   ip ospf message-digest-key 1 sha1 7 IKztbUioOmeKvhJbqBxkSw==
   ip ospf message-digest-key 2 sha512 7 7NoYEkopgjmY7JalZhrE1A==
!
interface Ethernet6
   description Inheriting no auth from VRF
   no shutdown
   mtu 9000
   no switchport
   vrf Tenant_OSPF_NO_VRF_LEVEL_ENCRYPTION
   ip address 10.10.20.20/24
   ip ospf cost 100
   ip ospf network point-to-point
   ip ospf area 0.0.0.0
!
interface Loopback0
   description ROUTER_ID
   no shutdown
   ip address 192.168.66.42/32
!
interface Loopback1
   description VXLAN_TUNNEL_SOURCE
   no shutdown
   ip address 192.168.142.42/32
!
interface Management1
   description OOB_MANAGEMENT
   no shutdown
   vrf MGMT
   ip address 192.168.42.42/24
!
interface Vlan201
   description Overwriting auth from VRF
   no shutdown
   vrf Tenant_OSPF_VRF_LEVEL_SIMPLE_ENCRYPTION
   ip ospf network point-to-point
   ip ospf authentication message-digest
   ip ospf area 0.0.0.0
   ip ospf message-digest-key 1 sha1 7 kqlwdQ0Qo9jv/tEckpNcGA==
   ip ospf message-digest-key 2 sha512 7 U9etm4c+zLuZxOMYA7tIgA==
!
interface Vlan202
   description Inheriting auth from VRF
   no shutdown
   vrf Tenant_OSPF_VRF_LEVEL_SIMPLE_ENCRYPTION
   ip ospf network point-to-point
   ip ospf authentication
   ip ospf authentication-key 7 SphQt8480K3DbPx81kMUOg==
   ip ospf area 0.0.0.0
!
interface Vlan204
   description Overwriting auth from VRF with simple
   no shutdown
   vrf Tenant_OSPF_VRF_LEVEL_SIMPLE_ENCRYPTION
   ip ospf cost 100
   ip ospf authentication
   ip ospf authentication-key 7 P6e73mHkLBd2exwHPq6K3A==
   ip ospf area 1
   ip address virtual 10.1.40.1/24
!
interface Vlan211
   description Overwriting auth from VRF with message-digest
   no shutdown
   vrf Tenant_OSPF_VRF_LEVEL_MESSAGE_DIGEST_ENCRYPTION
   ip ospf network point-to-point
   ip ospf authentication message-digest
   ip ospf area 0.0.0.0
   ip ospf message-digest-key 2 sha1 7 lXM5cHilRrqeai0AiIhkkw==
   ip ospf message-digest-key 3 sha512 7 A/B1olL6FaAcubQc401gvQ==
!
interface Vlan212
   description Inheriting auth from VRF
   no shutdown
   vrf Tenant_OSPF_VRF_LEVEL_MESSAGE_DIGEST_ENCRYPTION
   ip ospf network point-to-point
   ip ospf authentication message-digest
   ip ospf area 0.0.0.0
   ip ospf message-digest-key 1 sha256 7 ZhUR0eIyXeCKq+8HPmAgNA==
!
interface Vlan213
   description Overwriting auth from VRF with simple
   no shutdown
   vrf Tenant_OSPF_VRF_LEVEL_MESSAGE_DIGEST_ENCRYPTION
   ip ospf cost 100
   ip ospf authentication
   ip ospf authentication-key 7 9lUSaRCtplbyboJZn9kq5g==
   ip ospf area 1
   ip address virtual 10.1.30.1/24
!
interface Vlan221
   description Tenant_OSPF_221
   no shutdown
   vrf Tenant_OSPF_NO_VRF_LEVEL_ENCRYPTION
   ip ospf network point-to-point
   ip ospf authentication message-digest
   ip ospf area 0.0.0.0
   ip ospf message-digest-key 1 sha1 7 JdRf4IiexdoTU/k7sxiXxA==
   ip ospf message-digest-key 2 sha512 7 tZUPLhrrO3YDtlCXIjR8fQ==
!
interface Vlan222
   description Inheriting NO auth from VRF
   no shutdown
   vrf Tenant_OSPF_NO_VRF_LEVEL_ENCRYPTION
   ip ospf network point-to-point
   ip ospf area 0.0.0.0
!
interface Vxlan1
   description ospf-cleartext-passwords_VTEP
   vxlan source-interface Loopback1
   vxlan udp-port 4789
   vxlan vlan 201 vni 10201
   vxlan vlan 202 vni 10202
   vxlan vlan 204 vni 10204
   vxlan vlan 211 vni 10211
   vxlan vlan 212 vni 10212
   vxlan vlan 213 vni 10213
   vxlan vlan 221 vni 10221
   vxlan vlan 222 vni 10222
   vxlan vrf Tenant_OSPF_NO_VRF_LEVEL_ENCRYPTION vni 102
   vxlan vrf Tenant_OSPF_VRF_LEVEL_MESSAGE_DIGEST_ENCRYPTION vni 101
   vxlan vrf Tenant_OSPF_VRF_LEVEL_SIMPLE_ENCRYPTION vni 100
!
ip virtual-router mac-address 00:11:22:33:44:55
!
ip routing
no ip routing vrf MGMT
ip routing vrf Tenant_OSPF_NO_VRF_LEVEL_ENCRYPTION
ip routing vrf Tenant_OSPF_VRF_LEVEL_MESSAGE_DIGEST_ENCRYPTION
ip routing vrf Tenant_OSPF_VRF_LEVEL_SIMPLE_ENCRYPTION
!
ip prefix-list PL-LOOPBACKS-EVPN-OVERLAY
   seq 10 permit 192.168.66.0/24 eq 32
   seq 20 permit 192.168.142.0/24 eq 32
!
route-map RM-CONN-2-BGP permit 10
   match ip address prefix-list PL-LOOPBACKS-EVPN-OVERLAY
!
router bfd
   multihop interval 300 min-rx 300 multiplier 3
!
router bgp 666
   router-id 192.168.66.42
   update wait-install
   no bgp default ipv4-unicast
   maximum-paths 4 ecmp 4
   neighbor EVPN-OVERLAY-PEERS peer group
   neighbor EVPN-OVERLAY-PEERS update-source Loopback0
   neighbor EVPN-OVERLAY-PEERS bfd
   neighbor EVPN-OVERLAY-PEERS ebgp-multihop 3
   neighbor EVPN-OVERLAY-PEERS send-community
   neighbor EVPN-OVERLAY-PEERS maximum-routes 0
   neighbor IPv4-UNDERLAY-PEERS peer group
   neighbor IPv4-UNDERLAY-PEERS send-community
   neighbor IPv4-UNDERLAY-PEERS maximum-routes 12000
   redistribute connected route-map RM-CONN-2-BGP
   !
   vlan 201
      rd 192.168.66.42:20201
      route-target both 20201:20201
      redistribute learned
   !
   vlan 202
      rd 192.168.66.42:20202
      route-target both 20202:20202
      redistribute learned
   !
   vlan 204
      rd 192.168.66.42:20204
      route-target both 20204:20204
      redistribute learned
   !
   vlan 211
      rd 192.168.66.42:20211
      route-target both 20211:20211
      redistribute learned
   !
   vlan 212
      rd 192.168.66.42:20212
      route-target both 20212:20212
      redistribute learned
   !
   vlan 213
      rd 192.168.66.42:20213
      route-target both 20213:20213
      redistribute learned
   !
   vlan 221
      rd 192.168.66.42:20221
      route-target both 20221:20221
      redistribute learned
   !
   vlan 222
      rd 192.168.66.42:20222
      route-target both 20222:20222
      redistribute learned
   !
   address-family evpn
      neighbor EVPN-OVERLAY-PEERS activate
   !
   address-family ipv4
      no neighbor EVPN-OVERLAY-PEERS activate
      neighbor IPv4-UNDERLAY-PEERS activate
   !
   vrf Tenant_OSPF_NO_VRF_LEVEL_ENCRYPTION
      rd 192.168.66.42:44
      route-target import evpn 44:44
      route-target export evpn 44:44
      router-id 192.168.66.42
      redistribute connected
      redistribute ospf
   !
   vrf Tenant_OSPF_VRF_LEVEL_MESSAGE_DIGEST_ENCRYPTION
      rd 192.168.66.42:43
      route-target import evpn 43:43
      route-target export evpn 43:43
      router-id 192.168.66.42
      redistribute connected
      redistribute ospf
   !
   vrf Tenant_OSPF_VRF_LEVEL_SIMPLE_ENCRYPTION
      rd 192.168.66.42:42
      route-target import evpn 42:42
      route-target export evpn 42:42
      router-id 192.168.66.42
      redistribute connected
      redistribute ospf
!
router ospf 42 vrf Tenant_OSPF_VRF_LEVEL_SIMPLE_ENCRYPTION
   router-id 10.10.10.10
   passive-interface default
   no passive-interface Ethernet1
   no passive-interface Ethernet2
   no passive-interface Port-Channel1111.100
   no passive-interface Port-Channel1111.200
   no passive-interface Port-Channel1111.300
   no passive-interface Vlan201
   no passive-interface Vlan202
   no passive-interface Vlan204
   redistribute bgp
!
router ospf 43 vrf Tenant_OSPF_VRF_LEVEL_MESSAGE_DIGEST_ENCRYPTION
   router-id 10.10.10.20
   passive-interface default
   no passive-interface Ethernet3
   no passive-interface Ethernet4
   no passive-interface Vlan211
   no passive-interface Vlan212
   no passive-interface Vlan213
   redistribute bgp
!
router ospf 44 vrf Tenant_OSPF_NO_VRF_LEVEL_ENCRYPTION
   router-id 192.168.66.42
   passive-interface default
   no passive-interface Ethernet5
   no passive-interface Ethernet6
   no passive-interface Vlan221
   no passive-interface Vlan222
   redistribute bgp
!
end
