---
# Tests using cleartext OSPF passwords - verify they are automatically encrypted

type: l3leaf

l3leaf:
  defaults:
    loopback_ipv4_pool: 192.168.66.0/24
    vtep_loopback_ipv4_pool: 192.168.142.0/24
    virtual_router_mac_address: 00:11:22:33:44:55
    bgp_as: 666
  nodes:
    - name: ospf-cleartext-passwords
      id: 42
      mgmt_ip: 192.168.42.42/24

tenants:
  - name: Tenant_OSPF
    mac_vrf_vni_base: 10000
    mac_vrf_id_base: 20000
    redistribute_mlag_ibgp_peering_vrfs: true
    vrfs:
      - name: Tenant_OSPF_VRF_LEVEL_SIMPLE_ENCRYPTION
        vrf_vni: 100
        vrf_id: 42
        ospf:
          enabled: true
          router_id: 10.10.10.10
          # The VRF is configured with OSPF auth method simple
          authentication: simple
          cleartext_simple_auth_key: password
          nodes: [ospf-cleartext-passwords]
        svis:
          - id: 201
            name: Tenant_OSPF_201
            description: "Overwriting auth from VRF"
            enabled: true
            ospf:
              enabled: true
              area: 0.0.0.0
              authentication: message-digest
              point_to_point: true
              message_digest_keys:
                - id: 1
                  hash_algorithm: sha1
                  cleartext_key: arista
                - id: 2
                  cleartext_key: arista
          # test ospf authentication inherited from VRF vlan interface
          - id: 202
            name: Tenant_OSPF_202
            description: "Inheriting auth from VRF"
            enabled: true
            ospf:
              enabled: true
              point_to_point: true
          # test ospf simple authentication at SVI level overwriting VRF level
          - id: 204
            name: Tenant_OSPF_204
            enabled: true
            description: "Overwriting auth from VRF with simple"
            ip_address_virtual: 10.1.40.1/24
            ospf:
              enabled: true
              area: 1
              cost: 100
              authentication: simple
              cleartext_simple_auth_key: arista
        l3_interfaces:
          - interfaces: [Ethernet1]
            ip_addresses: [10.10.10.10/24]
            nodes: [ospf-cleartext-passwords]
            mtu: 9000
            enabled: true
            description: "Overwriting auth from VRF"
            ospf:
              enabled: true
              cost: 100
              authentication: message-digest
              point_to_point: true
              message_digest_keys:
                - id: 1
                  hash_algorithm: sha1
                  cleartext_key: arista
                - id: 2
                  cleartext_key: ClearText
          - interfaces: [Ethernet2]
            ip_addresses: [10.10.20.10/24]
            nodes: [ospf-cleartext-passwords]
            mtu: 9000
            enabled: true
            description: "Inheriting auth from VRF"
            ospf:
              enabled: true
              cost: 100
        l3_port_channels:
          - name: Port-Channel1111
            enabled: true
            node: ospf-cleartext-passwords
          - name: Port-Channel1111.100
            enabled: true
            ip_address: 1.1.1.30/29
            node: ospf-cleartext-passwords
            description: "Overwriting auth from VRF"
            ospf:
              enabled: true
              point_to_point: false
              area: "0.0.0.0"
              cost: 1
              authentication: simple
              cleartext_simple_auth_key: arista
          - name: Port-Channel1111.200
            enabled: true
            ip_address: 1.1.1.30/29
            node: ospf-cleartext-passwords
            description: "Overwriting auth from VRF"
            ospf:
              enabled: true
              point_to_point: false
              area: "0.0.0.0"
              cost: 1
              authentication: message-digest
              message_digest_keys:
                - id: 1
                  hash_algorithm: "sha256"
                  cleartext_key: arista
                - id: 2
                  cleartext_key: arista
          - name: Port-Channel1111.300
            enabled: true
            description: "Inheriting auth from VRF"
            ip_address: 1.1.1.30/29
            node: ospf-cleartext-passwords
            ospf:
              enabled: true
              point_to_point: false
              area: "0.0.0.0"
              cost: 1
      - name: Tenant_OSPF_VRF_LEVEL_MESSAGE_DIGEST_ENCRYPTION
        vrf_vni: 101
        vrf_id: 43
        ospf:
          enabled: true
          router_id: 10.10.10.20
          # The VRF is configured with OSPF auth method message-digest
          authentication: message-digest
          message_digest_keys:
            - id: 1
              hash_algorithm: sha256
              cleartext_key: arista
          nodes: [ospf-cleartext-passwords]
        svis:
          - id: 211
            name: Tenant_OSPF_211
            description: "Overwriting auth from VRF with message-digest"
            enabled: true
            ospf:
              enabled: true
              area: 0.0.0.0
              authentication: message-digest
              point_to_point: true
              # expects 2 keys
              message_digest_keys:
                - id: 2
                  hash_algorithm: sha1
                  cleartext_key: arista
                - id: 3
                  cleartext_key: arista2
          - id: 212
            name: Tenant_OSPF_212
            description: "Inheriting auth from VRF"
            enabled: true
            ospf:
              enabled: true
              point_to_point: true
          # test overwriting ospf authentication message-digest with simple for both nodes.
          - id: 213
            name: Tenant_OSPF_213
            description: "Overwriting auth from VRF with simple"
            enabled: true
            ip_address_virtual: 10.1.30.1/24
            ospf:
              enabled: true
              area: 1
              cost: 100
              authentication: simple
              cleartext_simple_auth_key: arista
        l3_interfaces:
          - interfaces: [Ethernet3]
            ip_addresses: [10.10.10.10/24]
            nodes: [ospf-cleartext-passwords]
            mtu: 9000
            enabled: true
            description: "Overwriting auth from VRF"
            ospf:
              enabled: true
              cost: 100
              authentication: message-digest
              point_to_point: true
              # overwriting keys from VRF - expect 2 keys
              message_digest_keys:
                - id: 2
                  hash_algorithm: sha1
                  cleartext_key: arista
                - id: 3
                  cleartext_key: ClearText
          - interfaces: [Ethernet4]
            ip_addresses: [10.10.20.10/24]
            nodes: [ospf-cleartext-passwords]
            mtu: 9000
            enabled: true
            description: "Inheriting auth from VRF"
            ospf:
              enabled: true
              cost: 100
              point_to_point: true
      - name: Tenant_OSPF_NO_VRF_LEVEL_ENCRYPTION
        vrf_vni: 102
        vrf_id: 44
        ospf:
          enabled: true
          # The VRF is configured without any OSPF encryption method
        svis:
          # test ospf authentication on vlan interface overwriting authentication from VRF.
          # expect 2 keys
          - id: 221
            name: Tenant_OSPF_221
            enabled: true
            ospf:
              enabled: true
              area: 0.0.0.0
              authentication: message-digest
              point_to_point: true
              message_digest_keys:
                - id: 1
                  hash_algorithm: sha1
                  cleartext_key: arista
                - id: 2
                  cleartext_key: arista2
          - id: 222
            name: Tenant_OSPF_222
            description: "Inheriting NO auth from VRF"
            enabled: true
            ospf:
              enabled: true
              point_to_point: true
        l3_interfaces:
          - interfaces: [Ethernet5]
            ip_addresses: [10.10.10.10/24]
            nodes: [ospf-cleartext-passwords]
            mtu: 9000
            enabled: true
            description: "Overwriting auth from VRF"
            ospf:
              enabled: true
              cost: 100
              authentication: message-digest
              point_to_point: true
              # overwriting keys from VRF
              message_digest_keys:
                - id: 1
                  hash_algorithm: sha1
                  cleartext_key: arista
                - id: 2
                  cleartext_key: ClearText
          - interfaces: [Ethernet6]
            ip_addresses: [10.10.20.20/24]
            nodes: [ospf-cleartext-passwords]
            mtu: 9000
            enabled: true
            description: "Inheriting no auth from VRF"
            ospf:
              enabled: true
              cost: 100
              point_to_point: true
