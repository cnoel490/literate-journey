# Copyright (c) 2025 Arista Networks, Inc.
# Use of this source code is governed by the Apache License 2.0
# that can be found in the LICENSE file.
# yaml-language-server: $schema=../../../_schema/avd_meta_schema.json
# Line above is used by RedHat's YAML Schema vscode extension
# Use Ctrl + Space to get suggestions for every field. Autocomplete will pop up after typing 2 letters.
type: dict
keys:
  cfm:
    description: |-
      Configure connectivity fault management (CFM).
      CFM is a network protocol for monitoring and troubleshooting Ethernet networks.
    type: dict
    keys:
      continuity_check_loc_state_action_disable_interface_routing:
        type: bool
        description: |-
          Disable routing on interfaces where a loss of connectivity (LOC) defect is detected.
          This prevents traffic from being routed to a faulty link.
      domains:
        type: list
        primary_key: name
        items:
          type: dict
          keys:
            name:
              type: str
              description: CFM domain name.
            level:
              type: int
              convert_types:
                - str
              required: true
              min: 0
              max: 7
              description: Maintenance domain level.
            associations:
              type: list
              primary_key: id
              description: List of maintenance associations.
              items:
                type: dict
                keys:
                  id:
                    type: int
                    convert_types:
                      - str
                    min: 1
                    max: 65535
                    description: Maintenance association ID.
                  direction:
                    type: str
                    valid_values:
                      - up
                      - down
                    description: Local maintenance endpoint direction.
                  end_points:
                    type: list
                    primary_key: id
                    description: Configure the maintenance endpoint(MEP).
                    items:
                      type: dict
                      keys:
                        id:
                          type: int
                          convert_types:
                            - str
                          min: 1
                          max: 8191
                          description: Local maintenance endpoint ID.
                        remote_end_point:
                          type: str
                          description: |-
                             Remote maintenance endpoint ID(s) or range(s) of remote maintenance endpoint ID(s).
                             The range is from 1 to 8191.
                          convert_types:
                            - int
                        interface:
                          type: str
                          description: |-
                            Specifies the interface on which to configure the local maintenance endpoint.
                            Supported types include Ethernet sub-interfaces, InternalRecirc, and Port-Channel link aggregation groups (LAGs).
                  profile:
                    type: str
                    description: Apply connectivity fault management profile.
                  remote_end_points:
                    type: list
                    primary_key: id
                    description: Configure the remote maintenance endpoint(RMEP).
                    items:
                      type: dict
                      keys:
                        id:
                          type: int
                          convert_types:
                            - str
                          min: 1
                          max: 8191
                          description: Configure remote maintenance endpoint ID.
                        mac_address:
                          type: str
                          description: MAC address of the RMEP.
                  vlan:
                    type: int
                    convert_types:
                      - str
                    description: Set VLAN in the maintenance association.
                    min: 1
                    max: 4094
            intermediate_point:
              type: bool
              description: Configure the device as a maintenance intermediate point.
      measurement_loss:
        type: dict
        description: Configure Ethernet OAM loss measurement functions.
        keys:
          inband:
            type: bool
            description: Enable hardware-assisted support for OAM loss measurement.
          synthetic:
            type: bool
            description: Enable hardware-assisted support for OAM synthetic loss measurement.
      profiles:
        type: list
        primary_key: name
        items:
          type: dict
          keys:
            name:
              type: str
              description: CFM profile name.
            alarm_indication:
              type: dict
              keys:
                enabled:
                  type: bool
                  description: Enable sending of alarm indication signal (AIS) packets.
                client_domain_level:
                  type: int
                  convert_types:
                    - str
                  min: 0
                  max: 7
                  description: Client maintenance domain level for which to send AIS packets.
                tx_interval:
                  type: str
                  description: Transmission interval for AIS packets.
                  valid_values:
                    - 1 seconds
                    - 1 minutes
            continuity_check:
              type: dict
              keys:
                enabled:
                  type: bool
                  description: Enable the continuity check protocol to monitor connectivity.
                qos_cos:
                  type: int
                  convert_types:
                    - str
                  description: Set the class of service (CoS) value for CFM frames.
                  min: 0
                  max: 7
                tx_interval:
                  type: str
                  description: Set the transmission interval for continuity check messages (CCMs).
                  valid_values:
                    - "3.33 milliseconds"
                    - "10 milliseconds"
                    - "100 milliseconds"
                    - "1 seconds"
                    - "10 seconds"
                    - "1 minutes"
                    - "10 minutes"
                alarm_defects:
                  type: list
                  min_length: 1
                  description: |-
                    Defines alarm indication signal protocol parameters. Supported options:
                    - rdi-ccm: Raise alarms on continuity check messages (CCMs) with the remote defect indication (RDI) bit set.
                    - loc-state: Raise alarms on loss of connectivity (LOC).
                    - error-ccm: Raise alarms on invalid continuity check messages (CCMs).
                    - cross-connection: Raise alarms on cross-connection defects.
                  items:
                    type: str
                    valid_values:
                      - rdi-ccm
                      - loc-state
                      - error-ccm
                      - cross-connection
            measurement:
              type: dict
              keys:
                delay:
                  type: dict
                  keys:
                    single_ended:
                      type: bool
                      description: Enable single-ended delay measurement.
                    qos_cos:
                      type: int
                      convert_types:
                        - str
                      description: Set the class of service (CoS) value for CFM frames.
                      min: 0
                      max: 7
                    tx_interval:
                      type: str
                      convert_types:
                        - int
                        - float
                      description: |-
                        Interval in milliseconds between successive measurement frames.
                        The range is from 3.33 to 600000.
                loss:
                  type: dict
                  keys:
                    single_ended:
                      type: bool
                      description: Enable single-ended loss measurement.
                    qos_cos:
                      type: int
                      convert_types:
                        - str
                      min: 0
                      max: 7
                      description: Set the class of service (CoS) value for CFM frames.
                    tx_interval:
                      type: str
                      convert_types:
                        - int
                        - float
                      description: |-
                        Interval in milliseconds between successive measurement frames.
                        The range is from 3.33 to 600000.
                    synthetic:
                      type: dict
                      keys:
                        single_ended:
                          type: bool
                          description: Enable single-ended synthetic loss measurement.
                        qos_cos:
                          type: str
                          description: Set the class of service (CoS) value or a range of values (0-7) for synthetic loss measurement.
                          convert_types:
                            - int
                        tx_interval:
                          type: dict
                          keys:
                            interval:
                              type: str
                              required: true
                              convert_types:
                                - int
                                - float
                              description: |-
                                Interval in milliseconds between successive measurement frames.
                                The range is from 3.33 to 600000.
                            period_frames:
                              type: int
                              convert_types:
                                - str
                              description: Synthetic loss measurement transmission frames.
                              min: 1
                              max: 65535
