# Copyright (c) 2025 Arista Networks, Inc.
# Use of this source code is governed by the Apache License 2.0
# that can be found in the LICENSE file.
# yaml-language-server: $schema=../../../_schema/avd_meta_schema.json
# Line above is used by RedHat's YAML Schema vscode extension
# Use Ctrl + Space to get suggestions for every field. Autocomplete will pop up after typing 2 letters.
type: dict
$defs:
  l2vlans:
    type: list
    items:
      type: dict
      keys:
        address_locking:
          type: dict
          $ref: "eos_cli_config_gen#/keys/vlans/items/keys/address_locking/keys/address_family"
        vni_override:
          type: int
          convert_types:
            - str
          min: 1
          max: 16777215
          description: |
            By default the VNI will be derived from mac_vrf_vni_base.
            The vni_override, allows to override this value and statically define it.
        rt_override:
          type: str
          convert_types:
            - int
          description: |
            By default the MAC VRF RT will be derived from mac_vrf_id_base + vlan_id.
            The rt_override allows us to override this value and statically define it.
            rt_override will default to vni_override if set.
            rt_override supports two formats:
              - A single number which will be used in the RT fields instead of mac_vrf_id/mac_vrf_vni (see 'overlay_rt_type' for details).
              - A full RT string with colon separator which will override the full RT.
        rd_override:
          type: str
          convert_types:
            - int
          description: |
            By default the MAC VRF RD will be derived from mac_vrf_id_base + vlan_id.
            The rt_override allows us to override this value and statically define it.
            rd_override will default to rt_override or vni_override if set.
            rd_override supports two formats:
              - A single number which will be used in the RD assigned number field instead of mac_vrf_id/mac_vrf_vni (see 'overlay_rd_type' for details).
              - A full RD string with colon separator which will override the full RD.
        vxlan:
          type: bool
          default: true
          description: Extend this L2VLAN over VXLAN.
        spanning_tree_priority:
          type: int
          convert_types:
            - str
          description: |-
            Setting spanning-tree priority per VLAN is only supported with `spanning_tree_mode: rapid-pvst` under node type settings.
            The default priority for rapid-PVST is set under the node type settings with `spanning_tree_priority` (default=32768).
        evpn_vlan_bundle:
          type: str
          description: |
            Name of a bundle defined under 'evpn_vlan_bundles' to inherit configuration.
            This setting overrides "evpn_vlan_bundle" set at tenant level.
            The common option "evpn_vlan_aware_bundles" is disregarded for this option.
        trunk_groups:
          type: list
          items:
            type: str
            description: |
              Trunk groups are used for limiting vlans to trunk ports assigned to the same trunk group.
              Requires enable_trunk_groups: true.
        evpn_l2_multi_domain:
          type: bool
          description: |
            Explicitly extend this VLAN to remote EVPN domains.
            Overrides `<network_services_key>[].evpn_l2_multi_domain`.
        evpn_l2_multicast:
          documentation_options:
            table: network-services-multicast-settings
          type: dict
          description: |
            Explicitly enable or disable evpn_l2_multicast to override setting of `<network_services_key>.[].evpn_l2_multicast.enabled`.
            When evpn_l2_multicast.enabled is set to true for a vlan or a tenant, igmp snooping and igmp snooping querier will always be enabled, overriding those individual settings.
            Requires `evpn_multicast` to also be set to `true`.
          keys:
            enabled:
              type: bool
        vxlan_flood_multicast:
          documentation_options:
            table: network-services-multicast-settings
          type: dict
          keys:
            enabled:
              type: bool
              description: |-
                Explicitly enable or disable vxlan_flood_multicast to override setting of `<network_services_key>.[].vxlan_flood_multicast.enabled`.
            underlay_multicast_group:
              description: Specific multicast group to use for this VLAN.
              type: str
        igmp_snooping_enabled:
          documentation_options:
            table: network-services-multicast-settings
          type: bool
          description: Enable or disable IGMP snooping (Enabled by default on EOS).
        igmp_snooping_querier:
          documentation_options:
            table: network-services-multicast-settings
          type: dict
          description: |
            Enable igmp snooping querier, by default using IP address of Loopback 0.
            When enabled, igmp snooping querier will only be configured on l3 devices, i.e., uplink_type: p2p.
          keys:
            enabled:
              type: bool
              description: Will be enabled automatically if evpn_l2_multicast is enabled.
            source_address:
              type: str
              description: |
                IPv4_address
                If not set, IP address of "Loopback0" will be used.
            version:
              type: int
              description: IGMP Version (By default EOS uses IGMP version 2 for IGMP querier).
              convert_types:
                - str
              valid_values:
                - 1
                - 2
                - 3
            fast_leave:
              type: bool
              description: Enable IGMP snooping fast-leave feature.
        bgp:
          type: dict
          keys:
            structured_config:
              type: dict
              relaxed_validation: true
              description: |
                Custom structured config added under router_bgp.vlans.[id=<vlan>] for eos_cli_config_gen.
                This configuration will not be applied to vlan aware bundles.
              documentation_options:
                hide_keys: true
              $ref: "eos_cli_config_gen#/keys/router_bgp/keys/vlans/items"
            raw_eos_cli:
              type: str
              description: |
                EOS cli commands rendered on router_bgp.vlans.
                This configuration will not be applied to vlan aware bundles.
        private_vlan:
          type: dict
          $ref: eos_cli_config_gen#/keys/vlans/items/keys/private_vlan
          keys:
            type:
              type: str
              required: true
            primary_vlan:
              type: int
              required: true
